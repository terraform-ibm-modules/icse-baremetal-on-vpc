# ICSE Baremetal on VPC Module

This module creates a single baremetal server with an optional floating IP on an existing subnet in an existing VPC.

## Example Usage

- [Example usage with no secondary interfaces](./acceptance_tests/module_test/)
- [Example usage with secondary interfaces](./acceptance_tests/secondary_nic_test/)

## Module Variables

Name                              | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Description                                                                                                                                                                                                                  | Sensitive | Default
--------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | -----------------------------------------
ibmcloud_api_key                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                              |           | 
region                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                              |           | 
prefix                            | string                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | The prefix that you would like to prepend to your resources                                                                                                                                                                  |           | 
tags                              | list(string)                                                                                                                                                                                                                                                                                                                                                                                                                                                            | List of Tags for the resource created                                                                                                                                                                                        |           | null
resource_group_id                 | string                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Resource group ID for the VSI                                                                                                                                                                                                |           | null
zone                              | string                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Zone where the VSI will be provisioned                                                                                                                                                                                       |           | 
vpc_id                            | string                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ID of the VPC where VSI will be provisioned                                                                                                                                                                                  |           | 
primary_subnet_id                 | string                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ID of the subnet where the VSI will be provisioned.                                                                                                                                                                          |           | 
primary_security_group_ids        | list(string)                                                                                                                                                                                                                                                                                                                                                                                                                                                            | (Optional) List of security group ids to add to the primary network interface. Using an empty list will assign the default VPC security group.                                                                               |           | []
primary_allowed_vlans             | list(string)                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Comma separated VLANs, Indicates what VLAN IDs (for VLAN type only) can use this physical (PCI type) interface. A given VLAN can only be in the allowed_vlans array for one PCI type adapter per bare metal server.          |           | null
primary_enable_infrastructure_nat | bool                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | " If true, the VPC infrastructure performs any needed NAT operations. If false, the packet is passed unmodified to/from the network interface, allowing the workload to perform any needed NAT operations. [default : true]" |           | true
primary_ip                        | object({ use_primary_ip = bool address = optional(string) auto_delete = optional(bool) name = optional(string) reserved_ip = optional(string) })                                                                                                                                                                                                                                                                                                                        | (Optional) Data describing the primary IP address for the server.                                                                                                                                                            |           | { use_primary_ip = false }
name                              | string                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Name of the server instance                                                                                                                                                                                                  |           | icse
image_id                          | string                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ID of the server image to use for VSI creation                                                                                                                                                                               |           | r010-68ec6c5d-c687-4dd3-8259-6f10d24ecd44
profile                           | string                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Type of machine profile for VSI. Use the command `ibmcloud is baremetal-profiles` to find available profiles in your region                                                                                                  |           | cx2-metal-96x192
ssh_key_ids                       | list(string)                                                                                                                                                                                                                                                                                                                                                                                                                                                            | List of SSH Key Ids. At least one SSH key must be provided                                                                                                                                                                   |           | 
boot_volume_name                  | string                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Boot volume name                                                                                                                                                                                                             |           | eth0
user_data                         | string                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | (Optional) Data to transfer to instance                                                                                                                                                                                      |           | null
allow_ip_spoofing                 | bool                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Allow IP spoofing on primary network interface                                                                                                                                                                               |           | false
add_floating_ip                   | bool                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Add a floating IP to the primary network interface.                                                                                                                                                                          |           | false
additional_network_interfaces     | list( object({ name = string subnet_id = string allowed_vlans = optional(list(number)) allow_ip_spoofing = optional(bool) enable_infrastructure_nat = optional(bool) hard_stop = optional(bool) security_group_ids = optional(list(string)) vlan = optional(number) add_floating_ip = optional(bool) primary_ip = object({ use_primary_ip = bool address = optional(string) auto_delete = optional(bool) name = optional(string) reserved_ip = optional(string) }) }) ) | List describing additional network interface for the baremetal                                                                                                                                                               |           | []
